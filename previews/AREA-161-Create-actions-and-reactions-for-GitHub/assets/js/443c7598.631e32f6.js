"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5678],{6640:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/new-action-reaction","title":"New Action or Reaction","description":"Quick summary","source":"@site/docs/guides/new-action-reaction.mdx","sourceDirName":"guides","slug":"/guides/new-action-reaction","permalink":"/area/guides/new-action-reaction","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"new-action-reaction","title":"New Action or Reaction"},"sidebar":"guidesSidebar","previous":{"title":"New Service","permalink":"/area/guides/new-service"}}');var i=s(4848),r=s(8453);const c={id:"new-action-reaction",title:"New Action or Reaction"},a="New Action or Reaction",o={},d=[{value:"Quick summary",id:"quick-summary",level:2},{value:"Files to edit/add",id:"files-to-editadd",level:2},{value:"Example: add Action &quot;New Push&quot; and Reaction &quot;Create Issue&quot; for Github",id:"example-add-action-new-push-and-reaction-create-issue-for-github",level:2},{value:"Common pitfalls and checks",id:"common-pitfalls-and-checks",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"new-action-or-reaction",children:"New Action or Reaction"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-summary",children:"Quick summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Actions are trigger checks that live in ",(0,i.jsx)(n.code,{children:"server/src/services/actions/**"})," and must export a default object with a ",(0,i.jsx)(n.code,{children:"check(area)"})," async function that returns ",(0,i.jsx)(n.code,{children:"true"})," when the action fires."]}),"\n",(0,i.jsxs)(n.li,{children:["Reactions are executors that live in ",(0,i.jsx)(n.code,{children:"server/src/services/reactions/**"})," and must export a default object with a ",(0,i.jsx)(n.code,{children:"run(area, reactionEntry)"})," async function that performs the reaction."]}),"\n",(0,i.jsxs)(n.li,{children:["Action and Reaction UI forms (fields) live as config objects in ",(0,i.jsx)(n.code,{children:"server/src/database/services/<service>/..."})," and are seeded into the DB by ",(0,i.jsx)(n.code,{children:"setupActions.js"})," and ",(0,i.jsx)(n.code,{children:"setupReactions.js"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"files-to-editadd",children:"Files to edit/add"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/database/services/<service>/*.js"})," \u2014 create config objects (e.g., ",(0,i.jsx)(n.code,{children:"fields"}),") used by the UI and exported for seeding."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/database/setupActions.js"})," \u2014 import the action config and add the action to the ",(0,i.jsx)(n.code,{children:"actions"})," array so it is seeded."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/database/setupReactions.js"})," \u2014 import the reaction config and add the reaction to the ",(0,i.jsx)(n.code,{children:"reactions"})," array."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/services/actions/<service>/<actionFile>.js"})," \u2014 add action implementation exporting default ",(0,i.jsx)(n.code,{children:"{ check }"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/services/reactions/<service>/<reactionFile>.js"})," \u2014 add reaction implementation exporting default ",(0,i.jsx)(n.code,{children:"{ run }"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/services/actions/index.js"})," \u2014 import and register the action handler in the ",(0,i.jsx)(n.code,{children:"actionsHandler"})," map using the action name string."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server/src/services/reactions/index.js"})," \u2014 import and register the reaction handler."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-add-action-new-push-and-reaction-create-issue-for-github",children:'Example: add Action "New Push" and Reaction "Create Issue" for Github'}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add UI config (database seed)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Create ",(0,i.jsx)(n.code,{children:"server/src/database/services/github/push.js"})," and export an action config, for example:"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"\t // server/src/database/services/github/push.js\n\t const githubPushActionConfig = {\n\t\t fields: [\n\t\t\t { id: 1, mandatory: true, name: 'Repository', title: 'Repository', input_field: { placeholder: 'owner/repo' } },\n\t\t ]\n\t };\n\n \t // export { githubPushActionConfig };\n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.code,{children:"server/src/database/setupActions.js"})," import this config and add the action row to the ",(0,i.jsx)(n.code,{children:"actions"})," array using the service id (the file already maps all known services to ids). The ",(0,i.jsx)(n.code,{children:"name"})," must match the handler key you will register later, e.g. ",(0,i.jsx)(n.code,{children:"'New Push'"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Implement the Action check handler"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"server/src/services/actions/github/push.js"}),":"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"\t import getAccessToken from '../../../utils/getAccessToken.js';\n\n\t async function check(area) {\n\t\t // sample: return true if the last push timestamp is within the last minute\n\t\t // use getAccessToken(area, 'Github') when you need an OAuth token\n\t\t return false; // implement actual API call against GitHub\n\t }\n\n \t // export default { check };\n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Register the handler in ",(0,i.jsx)(n.code,{children:"server/src/services/actions/index.js"})," with the action name used in DB:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"\t import * as githubPush from \"./github/push.js\";\n\n\t const actionsHandler = {\n\t\t 'New Push': githubPush.default ?? githubPush,\n\t\t // ...\n\t };\n\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Implement the Reaction run handler"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"server/src/services/reactions/github/createIssue.js"}),":"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"\t import getAccessToken from '../../../utils/getAccessToken.js';\n\n\t async function run(area, reactionEntry) {\n\t\t const accessToken = await getAccessToken(area, 'Github');\n\t\t if (!accessToken) throw new Error('Github not linked');\n\t\t // perform API call to create issue\n\t\t return 'Issue created';\n\t }\n\n \t // export default { run };\n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Register it in ",(0,i.jsx)(n.code,{children:"server/src/services/reactions/index.js"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"\t import * as githubCreateIssue from \"./github/createIssue.js\";\n\n\t const reactionsHandler = {\n\t\t 'Create Issue on GitHub': githubCreateIssue.default ?? githubCreateIssue,\n\t\t // ...\n\t };\n\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Seed the Reaction config in ",(0,i.jsx)(n.code,{children:"server/src/database/setupReactions.js"})," the same way as actions."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Test the handler"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Restart the server so seeds are run and confirm the new Action and Reaction are present using the API (e.g. ",(0,i.jsx)(n.code,{children:"GET /api/actions"}),", ",(0,i.jsx)(n.code,{children:"GET /api/reactions"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Create an Area using the Action name (trigger) and add your Reaction with required config fields. Monitor logs and ",(0,i.jsx)(n.code,{children:"AreaExecution"})," rows for success/failure."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-pitfalls-and-checks",children:"Common pitfalls and checks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Name matches: the string key used in ",(0,i.jsx)(n.code,{children:"actionsHandler"}),"/",(0,i.jsx)(n.code,{children:"reactionsHandler"})," must exactly match the ",(0,i.jsx)(n.code,{children:"Action.name"})," / ",(0,i.jsx)(n.code,{children:"Reaction.name"})," that you insert into the DB."]}),"\n",(0,i.jsxs)(n.li,{children:["Config shape: the UI expects ",(0,i.jsx)(n.code,{children:"fields"})," arrays (see ",(0,i.jsx)(n.code,{children:"server/src/database/services/google/gmail.js"})," for examples). Ensure mandatory flags and placeholders are present for a good UX."]}),"\n",(0,i.jsxs)(n.li,{children:["OAuth tokens: if your handler calls third-party APIs on behalf of a user, make sure the user has linked the service and that you implemented refresh token logic in ",(0,i.jsx)(n.code,{children:"refreshTokens.js"})," and a ",(0,i.jsx)(n.code,{children:"getAccessToken"})," branch."]}),"\n",(0,i.jsxs)(n.li,{children:["Error handling: action ",(0,i.jsx)(n.code,{children:"check"})," should throw on irrecoverable error; the area engine will catch it and create a failed ",(0,i.jsx)(n.code,{children:"AreaExecution"})," row. Reaction ",(0,i.jsx)(n.code,{children:"run"})," should throw on errors as well; the engine logs these and records failures."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var t=s(6540);const i={},r=t.createContext(i);function c(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);